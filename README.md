## Wallet-Service

Приложение, которое разрабатывалось в соответствии с ТЗ и проверялось ментором.<br />
Используемые технологии:

    JUnit
    PostgreSQL
    Liquibase
    Testcontainers
    Docker
    MapStruct
    AspectJ (далее Spring AOP)
    JWT
    Swagger
    Mockito, MockMVC
    REST

#### ТЗ №1.
Необходимо создать сервис, который управляет кредитными/дебетовыми транзакциями от имени игроков.<br />
Описание. Денежный счет содержит текущий баланс игрока. Баланс можно изменить, зарегистрировав транзакции на счете, 
либо дебетовые транзакции (удаление средств), либо кредитные транзакции (добавление средств). Создайте реализацию, 
которая соответствует описанным ниже требованиям и ограничениям.<br />
Требования:

    Данные хранятся в памяти приложений
    Приложение должно быть консольным (никаих спрингов, взаимодействий с БД и тд, только java-core и collections)
    Регистрация игрока
    Авторизация игрока
    Текущий баланс игрока
    Дебет/снятие средств для каждого игрока Дебетовая транзакция будет успешной только в том случае, если на счету достаточно средств (баланс - сумма дебета >= 0). - Вызывающая сторона предоставит идентификатор транзакции, который должен быть уникальным для всех транзакций. Если идентификатор транзакции не уникален, операция должна завершиться ошибкой.
    Кредит на игрока. Вызывающая сторона предоставит идентификатор транзакции, который должен быть уникальным для всех транзакций. Если идентификатор транзакции не уникален, операция должна завершиться ошибкой.
    Просмотр истории пополнения/снятия средств игроком
    Аудит действий игрока (авторизация, завершение работы, пополнения, снятия и тд)

    Нефункциональные требования: Unit-тестирование

#### ТЗ №2.
Необходимо обновить сервис, который вы разработали в первом задании согласно следующим требованиям и ограничениям.<br />
Требования:

    Репозитории теперь должны писать ВСЕ сущности в БД PostgreSQL
    Идентификаторы при сохранении в БД должны выдаваться через sequence
    DDL-скрипты на создание таблиц и скрипты на предзаполнение таблиц должны выполняться только инструментом миграции Liquibase
    Скрипты миграции Luiqbase должны быть написаны только в нотации XML
    Скриптов миграции должно быть несколько. Как минимум один на создание всех таблиц, другой - не предзаполнение данными
    Служебные таблицы должны быть в отдельной схеме
    Таблицы сущностей хранить в схеме public запрещено
    В тестах необходимо использовать test-containers
    В приложении должен быть docker-compose.yml, в котором должны быть прописаны инструкции для развертывания postgre в докере. Логин, пароль и база должны быть отличными от тех, что прописаны в образе по-умолчанию. Приложение должно работать с БД, развернутой в докере с указанными параметрами.
    Приложение должно поддерживать конфиг-файлы. Всё, что относится к подключению БД, а также к миграциям, должно быть сконфигурировано через конфиг-файл

#### ТЗ №3.
Необходимо обновить сервис, который вы разработали в первом задании согласно следующим требованиям и ограничениям.<br />
Требования:

    Все взаимодействие должно теперь осуществляться через отправку HTTP запросов
    Сервлеты должны принимать JSON и отдавать также JSON
    Использовать понятное именование эндпоинтов
    Возвращать разные статус-коды
    Добавить DTO (если ранее не было заложено)
    Для маппинга сущностей в дто использовать MapStruct
    Реализовать валидацию входящих ДТО
    Аудит переделать на аспекты
    Также реализовать на аспектах выполнение любого метода (с замером времени выполнения)
    Сервлеты должны быть покрыты тестами
    Метод логина должен выдавать JWT, остальные методы должны быть авторизационными и валидировать JWT

#### ТЗ №4.
Необходимо обновить сервис, который вы разработали в первом задании согласно следующим требованиям и ограничениям.<br />
Требования:

    Java-конфигурация приложения
    Кастомные конфигурационные файлы заменить на application.yml
    Удалить сервлеты, реализовать Rest-контроллеры (Spring MVC)
    Swagger + Swagger UI
    Аспекты переписать на Spring AOP
    Внедрение зависимостей ТОЛЬКО через конструктор
    Удалить всю логику создания сервисов, репозиториев и тд. Приложение должно полностью управляться спрингом
    Добавить тесты на контроллеры (WebMVC)

### Endpoints

URL приложения: `http://localhost:8080`

`/login` - вход в приложение с помощью email и пароля. Возвращает информацию об Игроке и токен аутентификации.<br />
`/logout` - выход из приложения. Требуется, выданный при логине, токен.<br />
`/player-register` - регистрация нового Игрока. Возвращает информацию о зарегистрированном Игроке.<br />
`/balance` - возвращает баланс счета Игрока. Требуется, выданный при логине, токен.<br />
`/transaction-log` - возвращает лог выполненных транзакций счета Игрока. Требуется, выданный при логине, токен.<br />
`/full-log` - возвращает полный лог действий Игрока включая информацию о транзакциях.<br />
`/transaction-register` - создание транзакции от имени залогиненного Игрока. Требуется, выданный при логине, токен.<br />
`/process` - запуск обработки транзакций.<br />

### Работа с приложением

В приложение есть тестовый Игрок.<br />
`/login` post-запрос `{ "email":"ivan@gmail.com", "password":"12345" }`<br />
`/logout` post-запрос, например: `{ "token": "eyJhbGciOiJIUzI1NiJ9..."}`<br />
`/player-register` post-запрос `{ "name":"Petr", "email":"petr@ya.ru", "password":"54321" }`<br />
`/balance` post-запрос, например: `{ "token": "eyJhbGciOiJIUzI1NiJ9..."}`<br />
`/transaction-log` post-запрос, например: `{ "token": "eyJhbGciOiJIUzI1NiJ9..."}`<br />
`/full-log` get-запрос `/full-log?id=1`<br />
`/transaction-register` post-запрос `{ "id":"711c12eb-9f98-417d-af8f-57f902d30008", "operationType":"CREDIT", "amount":"100.00", "description":"incoming", "token": "eyJhbGciOiJIUzI1NiJ9..." }`<br />
`/process` get-запрос<br />

### Порядок запуска из консоли

1. Склонировать репозиторий: `git clone https://github.com/ko6ak/Wallet-Service.git`. 
2. Перейти в папку с программой: `cd Wallet-Service`
3. Запустить docker-образ (файл docker.yml находится в корне проекта): `docker compose -f docker.yml up`
4. Собрать приложение: `mvn clean install`
5. Отправить JSON-запрос через Postman.